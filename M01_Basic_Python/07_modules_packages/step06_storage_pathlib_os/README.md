# M1.7 ‚Äî Modules & Packages
## Step 06 ‚Äî –•—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞ `pathlib` + `os` ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ history.json

> –¶–µ–ª—å —à–∞–≥–∞: –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å **–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ö—Ä–∞–Ω–µ–Ω–∏—è** ‚Äî –≤—ã–±—Ä–∞—Ç—å/—Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ —Ñ–∞–π–ª –∏—Å—Ç–æ—Ä–∏–∏, –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞—è –¥–∞–Ω–Ω—ã–µ (–∑–∞–ø–∏—Å—å –±—É–¥–µ—Ç –≤ Step 07).

---

### üéØ –ß—Ç–æ —Ç—ã –æ—Å–≤–æ–∏—à—å
- –†–∞–±–æ—Ç–∞ —Å –ø—É—Ç—è–º–∏ —á–µ—Ä–µ–∑ `pathlib.Path` (–∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ).
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `os.getenv`.
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π/—Ñ–∞–π–ª–æ–≤ (`mkdir`, `touch`).
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ CLI‚Äë—Ñ–ª–∞–≥–æ–≤ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ—Å—Ç–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è.

---

## üìò –ü–æ–ª–Ω–∞—è —Ç–µ–æ—Ä–∏—è

### 1) Pathlib essentials
```python
from pathlib import Path

d = Path.home() / ".calc_data"              # –¥–µ—Ñ–æ–ª—Ç–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
d.exists(); d.is_dir(); d.is_file()
d.mkdir(parents=True, exist_ok=True)        # —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

f = d / "history.json"
f.touch(exist_ok=True)                      # —Å–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª
f.resolve()                                 # –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å
```

### 2) –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```python
import os
custom = os.getenv("CALC_DIR")  # None, –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω–æ
```
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—É—Ç–µ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π):
1) —Ñ–ª–∞–≥ `--history-dir`,
2) `CALC_DIR` –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è,
3) `Path.home() / ".calc_data"` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

### 3) –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ.
- –ü—Ä–æ–≤–µ—Ä—è–π –∫–æ–ª–ª–∏–∑–∏–∏: –ø–æ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É –º–æ–∂–µ—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —à–∞–≥–∞
```
M01_Basic_Python/07_modules_packages/step6_storage_pathlib_os/
‚îî‚îÄ app/
   ‚îú‚îÄ __init__.py
   ‚îú‚îÄ main.py
   ‚îú‚îÄ core/
   ‚îÇ  ‚îú‚îÄ __init__.py
   ‚îÇ  ‚îî‚îÄ operations.py
   ‚îî‚îÄ utils/
      ‚îú‚îÄ __init__.py
      ‚îî‚îÄ storage.py   # —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø—É—Ç–µ–π/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π/—Ñ–∞–π–ª–æ–≤
```

---

## üß© –ó–∞–¥–∞–Ω–∏—è

### 1) `utils/storage.py`
–†–µ–∞–ª–∏–∑—É–π —Ñ—É–Ω–∫—Ü–∏–∏:
- `get_data_dir(flag_path: str | None = None) -> Path`
  –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Ö—Ä–∞–Ω–µ–Ω–∏—è (—Ñ–ª–∞–≥ ‚Üí env `CALC_DIR` ‚Üí `~/.calc_data`).
- `ensure_data_dir(path: Path) -> bool | str`
  –°–æ–∑–¥–∞—ë—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏; –µ—Å–ª–∏ –ø–æ –ø—É—Ç–∏ **—Ñ–∞–π–ª** ‚Äî –≤–µ—Ä–Ω–∏ —Å—Ç—Ä–æ–∫—É‚Äë–æ—à–∏–±–∫—É.
- `get_history_path(data_dir: Path) -> Path`
  –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `data_dir / "history.json"`.
- `ensure_history_file(history_path: Path) -> bool | str`
  –°–æ–∑–¥–∞—ë—Ç –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏; –µ—Å–ª–∏ –ø–æ –ø—É—Ç–∏ **–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è** ‚Äî –≤–µ—Ä–Ω–∏ —Å—Ç—Ä–æ–∫—É‚Äë–æ—à–∏–±–∫—É.

### 2) –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `app/main.py`
–î–æ–±–∞–≤—å —Ñ–ª–∞–≥–∏:
- `--history-dir PATH` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—É—Ç—å –∫ –∫–∞—Ç–∞–ª–æ–≥—É —Ö—Ä–∞–Ω–µ–Ω–∏—è;
- `--show-history-path` ‚Äî –Ω–∞–ø–µ—á–∞—Ç–∞—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ä–∞–±–æ—Ç—É.

–ü–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –æ–ø–µ—Ä–∞—Ü–∏–∏:
1) `data_dir = get_data_dir(args.history_dir)`
2) `ensure_data_dir(data_dir)`
3) `history = get_history_path(data_dir)`
4) `ensure_history_file(history)`
5) –µ—Å–ª–∏ `--show-history-path` ‚Üí –≤—ã–≤–µ—Å—Ç–∏ `history.resolve()` –∏ `return`

---

## ‚ñ∂Ô∏è –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å
–ò–∑ –ø–∞–ø–∫–∏ —à–∞–≥–∞:
```bash
# –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø—É—Ç—å (~/.calc_data)
python -m app.main add 1 2 --show-history-path

# —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è (PowerShell)
$env:CALC_DIR="C:\Temp\my_calc"
python -m app.main add 1 2 --show-history-path

# —Ñ–ª–∞–≥ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç env
python -m app.main add 5 7 --history-dir "C:\Temp\my_calc2" --show-history-path
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- [x] –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∏ –ø—É—Å—Ç–æ–π `history.json`.
- [x] `--show-history-path` –ø–µ—á–∞—Ç–∞–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å.
- [x] –†–∞–±–æ—Ç–∞—é—Ç —Ç—Ä–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è –≤—ã–±–æ—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (—Ñ–ª–∞–≥ > env > –¥–µ—Ñ–æ–ª—Ç).
- [x] –ù–∏–∫–∞–∫–∏—Ö —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–æ–∫/–∏—Å–∫–ª—é—á–µ–Ω–∏–π ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

---

## üõü –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

**`ModuleNotFoundError: No module named 'app'`**
‚Äî –ó–∞–ø—É—Å–∫–∞–π –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—è –ø–∞–ø–∫–∏ `app/` (–∫–∞—Ç–∞–ª–æ–≥ —à–∞–≥–∞).

**–ü–æ –ø—É—Ç–∏ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –æ–∫–∞–∑–∞–ª—Å—è —Ñ–∞–π–ª**
‚Äî `ensure_data_dir` –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Å—Ç—Ä–æ–∫—É‚Äë–æ—à–∏–±–∫—É; –≤—ã–≤–µ–¥–∏ –µ—ë –∏ –∑–∞–≤–µ—Ä—à–∏ —Ä–∞–±–æ—Ç—É.

**–ü–æ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É –∏—Å—Ç–æ—Ä–∏–∏ –æ–∫–∞–∑–∞–ª–∞—Å—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è**
‚Äî `ensure_history_file` –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Å—Ç—Ä–æ–∫—É‚Äë–æ—à–∏–±–∫—É.
