# M2.8 ‚Äî –ú–∞–≥–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã (`__len__`, `__iter__`, `__getitem__`)

–ú–æ–¥—É–ª—å –ø–æ—Å–≤—è—â—ë–Ω **–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–º –º–∞–≥–∏—á–µ—Å–∫–∏–º –º–µ—Ç–æ–¥–∞–º Python** –∏ –∏—Ö –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–º—É –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é.
–¶–µ–ª—å ‚Äî –Ω–∞—É—á–∏—Ç—å—Å—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ **–≤–µ–¥—É—Ç —Å–µ–±—è –∫–∞–∫ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏** (`list`, `tuple`, `dict`), –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç `len()`, –∏—Ç–µ—Ä–∞—Ü–∏—é, –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –∏ —Å—Ä–µ–∑—ã, –∞ —Ç–∞–∫–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ç–∏–ø–∏–∑–∏—Ä—É—é—Ç—Å—è.

---

## üéØ –ß—Ç–æ —Ç—ã –æ—Å–≤–æ–∏—à—å

- —á—Ç–æ —Ç–∞–∫–æ–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã Python
- –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `__len__` –∏ –≥–¥–µ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª –∏—Ç–µ—Ä–∞—Ü–∏–∏ (`__iter__`)
- –∫–∞–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∏ —Å—Ä–µ–∑—ã —á–µ—Ä–µ–∑ `__getitem__`
- —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ —Å—Ä–µ–∑–∞–º–∏ (`int` vs `slice`)
- –≤–æ–∑–≤—Ä–∞—Ç **–æ–±—ä–µ–∫—Ç–∞ —Ç–æ–≥–æ –∂–µ —Ç–∏–ø–∞** –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å–æ —Å—Ä–µ–∑–∞–º–∏
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é `__getitem__` —á–µ—Ä–µ–∑ `@overload`
- –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
- –∑–∞—â–∏—Ç—É –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏ –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö

---

## üìò –ü–æ–ª–Ω–∞—è —Ç–µ–æ—Ä–∏—è

### `__len__`

–ú–µ—Ç–æ–¥ `__len__` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ `len(obj)`
–∏ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –ª–æ–≥–∏—á–µ—Å–∫–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ (`if obj:`), –µ—Å–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω `__bool__`.

–ü—Ä–∏–º–µ—Ä:

```python
class Box:
    def __init__(self, items: list[str]) -> None:
        self._items = items

    def __len__(self) -> int:
        return len(self._items)
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```python
box = Box(["apple", "banana"])

len(box)     # 2
if box:      # True, —Ç–∞–∫ –∫–∞–∫ len(box) > 0
    ...
```

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ `__len__`:
- –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `int >= 0`
- –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±—ã—Å—Ç—Ä—ã–º (–æ–±—ã—á–Ω–æ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É)
- –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞

---

### `__iter__`

–ú–µ—Ç–æ–¥ `__iter__` –¥–µ–ª–∞–µ—Ç –æ–±—ä–µ–∫—Ç **–∏—Ç–µ—Ä–∏—Ä—É–µ–º—ã–º**, –ø–æ–∑–≤–æ–ª—è—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤:
- `for`
- `list(obj)`
- `sum(obj)`
- `enumerate(obj)`
- –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞—Ö –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–µ

–ü—Ä–∏–º–µ—Ä:

```python
class Log:
    def __init__(self, records: list[str]) -> None:
        self._records = records

    def __iter__(self):
        return iter(self._records)
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```python
log = Log(["start", "process", "end"])

for record in log:
    print(record)

list(log)  # ["start", "process", "end"]
```

–í–∞–∂–Ω–æ:
- `__iter__` –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å **–∏—Ç–µ—Ä–∞—Ç–æ—Ä**
- —á–∞—â–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `iter(self._storage)`
- `__next__` —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ, –µ—Å–ª–∏ –¥–µ–ª–µ–≥–∏—Ä—É–µ—à—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É

---

### `__getitem__`

–ú–µ—Ç–æ–¥ `__getitem__` –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –¥–æ—Å—Ç—É–ø –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º:

- `obj[i]` ‚Üí –∏–Ω–¥–µ–∫—Å (`int`)
- `obj[a:b]` ‚Üí —Å—Ä–µ–∑ (`slice`)

–ü—Ä–æ—Å—Ç–µ–π—à–∏–π –ø—Ä–∏–º–µ—Ä –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:

```python
class Vector:
    def __init__(self, values: list[int]) -> None:
        self._values = values

    def __getitem__(self, index: int) -> int:
        return self._values[index]
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```python
v = Vector([10, 20, 30])

v[0]    # 10
v[-1]   # 30
```

–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–∫—É.

---

### –†–∞–±–æ—Ç–∞ —Å–æ `slice`

–ü—Ä–∏ —Å—Ä–µ–∑–µ Python –ø–µ—Ä–µ–¥–∞—ë—Ç –≤ `__getitem__` –æ–±—ä–µ–∫—Ç `slice`:

```python
slice(start, stop, step)
```

–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ ‚Äî **–≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–±—ä–µ–∫—Ç —Ç–æ–≥–æ –∂–µ –∫–ª–∞—Å—Å–∞**, –∞ –Ω–µ `list`.

–ü—Ä–∏–º–µ—Ä:

```python
class WindowView:
    def __init__(self, data: list[int]) -> None:
        self._data = data

    def __getitem__(self, key):
        if isinstance(key, slice):
            return WindowView(self._data[key])
        return self._data[key]
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```python
w = WindowView([1, 2, 3, 4, 5])

w[1]        # 2
w[1:4]      # WindowView([2, 3, 4])
```

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç API –∫–ª–∞—Å—Å–∞ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º –∏ ‚Äú–ø–∏—Ç–æ–Ω–∏—á–Ω—ã–º‚Äù.

---

### –°–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ `__len__`, `__iter__`, `__getitem__`

–ï—Å–ª–∏ –∫–ª–∞—Å—Å —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤—Å–µ —Ç—Ä–∏ –º–µ—Ç–æ–¥–∞, –æ–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç –≤–µ—Å—Ç–∏ —Å–µ–±—è –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è.

–ü—Ä–∏–º–µ—Ä:

```python
class Playlist:
    def __init__(self, tracks: list[str]) -> None:
        self._tracks = tracks

    def __len__(self):
        return len(self._tracks)

    def __iter__(self):
        return iter(self._tracks)

    def __getitem__(self, key):
        if isinstance(key, slice):
            return Playlist(self._tracks[key])
        return self._tracks[key]
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```python
playlist = Playlist(["song1", "song2", "song3"])

len(playlist)
for track in playlist:
    ...
playlist[0]
playlist[1:3]
```

---

### –¢–∏–ø–∏–∑–∞—Ü–∏—è `__getitem__` –∏ `@overload`

–ü—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ—Å—Ç–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏:

```python
def __getitem__(self, key: int | slice) -> T | Playlist:
```

–¢–∞–∫–æ–π `Union` –º–µ—à–∞–µ—Ç mypy –ø–æ–Ω—è—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–µ—Ä–Ω—ë—Ç—Å—è –ø—Ä–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –≤—ã–∑–æ–≤–µ.

–†–µ—à–µ–Ω–∏–µ ‚Äî `@overload`:

```python
@overload
def __getitem__(self, key: int) -> str: ...

@overload
def __getitem__(self, key: slice) -> Playlist: ...
```

–ò –æ–¥–Ω–∞ —Ä–µ–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ overload‚Äô–æ–≤:

```python
def __getitem__(self, key: int | slice):
    ...
```

–¢–∞–∫ mypy —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—Ç:
- `playlist[0]` ‚Üí `str`
- `playlist[1:3]` ‚Üí `Playlist`

---

### –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

–ß–∞—Å—Ç—ã–π –∏ –Ω–∞–¥—ë–∂–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω:

- –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è `list`
- –Ω–∞—Ä—É–∂—É –æ—Ç–¥–∞—ë—Ç—Å—è `tuple` –∏–ª–∏ `Sequence`
- –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞

–ü—Ä–∏–º–µ—Ä:

```python
@property
def items(self) -> tuple[str, ...]:
    return tuple(self._items)
```

–≠—Ç–æ:
- –∑–∞—â–∏—â–∞–µ—Ç –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã
- –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ–±—Ö–æ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –¥–µ–ª–∞–µ—Ç API –±–µ–∑–æ–ø–∞—Å–Ω—ã–º

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
08_magic_methods/
‚îú‚îÄ‚îÄ task01_box_len.py
‚îú‚îÄ‚îÄ task02_iterable_log.py
‚îú‚îÄ‚îÄ task03_vector_getitem.py
‚îú‚îÄ‚îÄ task04_window_view.py
‚îú‚îÄ‚îÄ task05_playlist_container.py
‚îî‚îÄ‚îÄ README.md
```

---

## üß© –ó–∞–¥–∞–Ω–∏—è

### Task 01 ‚Äî `__len__`: Box
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π `len()` –∏ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

### Task 02 ‚Äî `__iter__`: IterableLog
–°–æ–∑–¥–∞–Ω–∏–µ –∏—Ç–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ —Å `for` –∏ `list()`.

### Task 03 ‚Äî `__getitem__`: SimpleVector
–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏, –≤–∫–ª—é—á–∞—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã, —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π.

### Task 04* ‚Äî `__getitem__` + `slice`: WindowView
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ä–µ–∑–æ–≤ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º –æ–±—ä–µ–∫—Ç–∞ —Ç–æ–≥–æ –∂–µ –∫–ª–∞—Å—Å–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `@overload`.

### Task 05** ‚Äî Playlist
–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
- `len`, `iter`, `getitem`
- –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ä–µ–∑–æ–≤
- –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–π API

---

## ‚ñ∂Ô∏è –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å

```bash
python task01_box_len.py
python task02_iterable_log.py
python task03_vector_getitem.py
python task04_window_view.py
python task05_playlist_container.py
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏:
```bash
mypy .
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã `__len__`, `__iter__`, `__getitem__`
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ —Å—Ä–µ–∑–∞–º–∏
- –ø—Ä–∏ —Å—Ä–µ–∑–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç —Ç–æ–≥–æ –∂–µ –∫–ª–∞—Å—Å–∞
- `@overload` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–æ—á–Ω–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏
- –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –∫–ª–∞—Å—Å–∞ –∑–∞—â–∏—â–µ–Ω—ã
- mypy –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- –∫–æ–¥ —á–∏—Ç–∞–µ–º—ã–π –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏ —Ü–µ–ª—å–Ω—ã–π

---

## üõü –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

**`mypy` —Ä—É–≥–∞–µ—Ç—Å—è –Ω–∞ `Union` –≤ `__getitem__`**
‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@overload`

**`slice` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `list`, –∞ –Ω–µ –æ–±—ä–µ–∫—Ç –∫–ª–∞—Å—Å–∞**
‚Üí –æ–±–æ—Ä–∞—á–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä

**–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–Ω–∞—Ä—É–∂–∏**
‚Üí –æ—Ç–¥–∞–≤–∞—Ç—å `tuple` –∏–ª–∏ `Sequence`, —Ö—Ä–∞–Ω–∏—Ç—å `list` –≤–Ω—É—Ç—Ä–∏

**`enumerate(obj)` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**
‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é `__iter__`
